---
import Layout from "../../layouts/Layout.astro";
import { main_schema } from "../../mainSchema";

const title = "Contact Hostino | Agence Marketing Digital Maroc";
const description =
  "Contactez Hostino, votre agence de marketing digital au Maroc. Appelez-nous au +212 663 75 09 08 ou envoyez-nous un message via notre formulaire de contact.";
const imageUrl =
  "https://maroc-1hp.pages.dev/images/agence-seo-maroc/agence-seo-maroc.png";
const canonical_url = "/contact";
const ogAlt = "Contact Hostino";

const articleSchema = {
  "@context": "https://schema.org",
  "@graph": [
    ...main_schema,
    {
      "@type": "BreadcrumbList",
      "@id": "https://www.hostino.ma/#breadcrumb",
      itemListElement: [
        {
          "@type": "ListItem",
          position: 1,
          item: {
            "@id": "https://www.hostino.ma",
            name: "Hostino - Noms de domaine et hébergement web au Maroc",
          },
        },
        {
          "@type": "ListItem",
          position: 2,
          item: {
            "@id": canonical_url,
            name: ogAlt,
          },
        },
      ],
    },
  ],
};
---

<Layout
  title={title}
  description={description}
  canonical_url={canonical_url}
  imageUrl={imageUrl}
  ogAlt={ogAlt}
  articleSchema={articleSchema}
>
  <section class="bg-gray-100 min-h-screen py-[80px]">
    <div class="container">
      <div class="grid lg:grid-cols-2 sm:text-left text-center  gap-8 lg:gap-12">
        <!-- Left Section: Contact Information -->
        <div class="space-y-8">
          <div>
            <h1 class="big-title leading-[65px] font-semibold text-title sm:mb-4 mb-[30px] ">
              Contacter un </br class="md:block hidden"> conseiller <span class="border-b-4 border-primary">Hostino™</span>
            </h1>
            <p class="paragraph">
              L'équipe Hostino se met à votre disposition pour répondre à toutes vos questions.
            </p>
          </div>

          <!-- Phone -->
          <div class="space-y-2 flex sm:justify-start justify-center">
            <div class="flex items-center gap-3">
             <div class="sm:w-[50px] w-[35px] bg-primary flex justify-center items-center sm:h-[50px] h-[35px] rounded-full">
                 <svg class="sm:w-8 w-6 h-6 sm:h-8 text-white flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                   <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z" />
                 </svg>
             </div>
               <div class="flex flex-col gap-[8px]">
                  <p class="text-[15px] font-normal text-title uppercase tracking-wide">DES QUESTIONS ?</p>

              <a  class="text-title tracking-[-0.5px] font-semibold text-[25px] ">
                +212 05 31 03 11 86
              </a>
               </div>
            </div>
          </div>

          <!-- WhatsApp -->
           <div class="space-y-2 flex sm:justify-start justify-center">
            <div class="flex items-center gap-3">
             <div class="sm:w-[50px] w-[35px] bg-primary flex justify-center items-center sm:h-[50px] h-[35px] rounded-full">
                  <svg class="sm:w-8 w-6 h-6 sm:h-8 text-white flex-shrink-0" fill="currentColor" viewBox="0 0 24 24">
                <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
              </svg>
             </div>
               <div class="flex flex-col gap-[8px]">
                  <p class="text-[15px] font-normal text-title uppercase tracking-wide">WHATSAPP </p>

              <a href="https://wa.me/212663750908" target="_blank" rel="noopener noreferrer" class="text-title tracking-[-0.5px] font-semibold text-[25px]">
                +212 663 75 09 08
              </a>
               </div>
            </div>
          </div>
         

          <!-- Email -->
          <div class="space-y-2 text-center sm:text-left">
            <p class="text-[15px] font-normal text-title uppercase tracking-wide">CONSULTATION PAR EMAIL ?</p>
              
              <a href="mailto:info@hostino.com" class="text-title font-semibold text-[25px] border-bottom border-primary hover:text-primary transition-colors">
                info@hostino.com
              </a>
          </div>
        </div>

        <!-- Right Section: Contact Form -->
        <div class="bg-white rounded-[10px] p-[30px] md:p-[40px]">
          <form id="contact-form " class="gap-[25px] grid grid-cols-2">
            <!-- Full Name -->
            <div class="col-span-2 md:col-span-1">
              <label for="fullName" class="block text-left text-[15px] font-normal text-title mb-2">
                Nom et prénom
              </label>
              <input
                type="text"
                id="fullName"
                name="fullName"
                required
                class="w-full px-4 bg-gray-100 py-3 rounded-[26px]  focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-all"
                placeholder="Votre nom complet"
              />
              <span class="error-message text-red-500 text-[15px] hidden"></span>
            </div>

            <!-- Company -->
            <div class="col-span-2 md:col-span-1">
              <label for="company" class="block text-left text-[15px] font-normal text-title mb-2">
                Entreprise
              </label>
              <input
                type="text"
                id="company"
                name="company"
                class="w-full px-4 bg-gray-100 py-3 rounded-[26px]  focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-all"
                placeholder="Nom de votre entreprise"
              />
            </div>

            <!-- Phone -->
            <div class="col-span-2 md:col-span-1">
              <label for="phone" class="block text-left text-[15px] font-normal text-title mb-2">
                Téléphone
              </label>
              <input
                type="tel"
                id="phone"
                name="phone"
                class="w-full px-4 bg-gray-100 py-3 rounded-[26px]  focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-all"
                placeholder="Votre numéro de téléphone"
              />
              <span class="error-message text-red-500 text-[15px] hidden"></span>
            </div>

            <!-- Email -->
            <div class="col-span-2 md:col-span-1">
              <label for="email" class="block text-left text-[15px] font-normal text-title mb-2">
                Email <span class="text-red-500">*</span>
              </label>
              <input
                type="email"
                id="email"
                name="email"
                required
                class="w-full px-4 bg-gray-100 py-3 rounded-[26px]  focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-all"
                placeholder="votre@email.com"
              />
              <span class="error-message text-red-500 text-[15px] hidden"></span>
            </div>

            <!-- Message -->
            <div class="col-span-2">
              <label for="message" class="block text-left text-[15px] font-normal text-title mb-2">
                Message <span class="text-red-500">*</span>
              </label>
              <textarea
                id="message"
                name="message"
                rows="5"
                required
                class="w-full px-4 bg-gray-100 py-3 rounded-[26px]  focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-all resize-none"
                placeholder="Votre message..."
              ></textarea>
              <span class="error-message text-red-500 text-[15px] hidden"></span>
            </div>

            <!-- Submit Button -->
           <div class="col-span-2 text-center">
             <button
              type="submit"
              class=" bg-primary hover:bg-primary/90 text-white font-normal w-full sm:w-[80%] mx-auto py-[13px] text-center rounded-[26px] transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
            >
              Envoyer
            </button>
           </div>

            <!-- Success/Error Message -->
            <div id="form-message" class="hidden text-[15px] text-center py-2 rounded-[26px]"></div>
          </form>
        </div>
      </div>
    </div>
  </section>
</Layout>

<script>
  const form = document.getElementById('contact-form') as HTMLFormElement;
  const submitButton = form?.querySelector('button[type="submit"]') as HTMLButtonElement;
  const messageDiv = document.getElementById('form-message') as HTMLDivElement;

  // Validation functions
  function validateName(name: string): { valid: boolean; error?: string } {
    const trimmed = name.trim();
    if (trimmed.length < 2) {
      return { valid: false, error: 'Le nom doit contenir au moins 2 caractères' };
    }
    if (trimmed.length > 100) {
      return { valid: false, error: 'Le nom ne peut pas dépasser 100 caractères' };
    }
    const nameRegex = /^[\p{L}\s'-]+$/u;
    if (!nameRegex.test(trimmed)) {
      return { valid: false, error: 'Le nom contient des caractères invalides' };
    }
    return { valid: true };
  }

  function validateEmail(email: string): { valid: boolean; error?: string } {
    const trimmed = email.trim().toLowerCase();
    if (trimmed.length === 0) {
      return { valid: false, error: 'L\'email est requis' };
    }
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(trimmed)) {
      return { valid: false, error: 'Veuillez entrer une adresse email valide' };
    }
    return { valid: true };
  }

  function validatePhone(phone: string): { valid: boolean; error?: string } {
    if (!phone || phone.trim().length === 0) {
      return { valid: true }; // Phone is optional
    }
    const cleanPhone = phone.replace(/[\s\-().]/g, '');
    const digitsOnly = cleanPhone.replace(/\+/g, '');
    if (digitsOnly.length < 7 || digitsOnly.length > 15) {
      return { valid: false, error: 'Le numéro de téléphone doit contenir entre 7 et 15 chiffres' };
    }
    return { valid: true };
  }

  function validateMessage(message: string): { valid: boolean; error?: string } {
    const trimmed = message.trim();
    if (trimmed.length < 10) {
      return { valid: false, error: 'Le message doit contenir au moins 10 caractères' };
    }
    if (trimmed.length > 2000) {
      return { valid: false, error: 'Le message ne peut pas dépasser 2000 caractères' };
    }
    return { valid: true };
  }

  function showError(input: HTMLElement, message: string) {
    const errorSpan = input.parentElement?.querySelector('.error-message') as HTMLSpanElement;
    if (errorSpan) {
      errorSpan.textContent = message;
      errorSpan.classList.remove('hidden');
    }
    input.classList.add('border-red-500');
  }

  function clearError(input: HTMLElement) {
    const errorSpan = input.parentElement?.querySelector('.error-message') as HTMLSpanElement;
    if (errorSpan) {
      errorSpan.classList.add('hidden');
    }
    input.classList.remove('border-red-500');
  }

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();

    // Clear previous errors
    const allInputs = form.querySelectorAll('input, textarea');
    allInputs.forEach((input) => clearError(input as HTMLElement));

    // Get form data
    const formData = new FormData(form);
    const fullName = formData.get('fullName') as string;
    const company = formData.get('company') as string;
    const phone = formData.get('phone') as string;
    const email = formData.get('email') as string;
    const message = formData.get('message') as string;

    // Client-side validation
    let isValid = true;

    const nameValidation = validateName(fullName);
    if (!nameValidation.valid) {
      showError(form.querySelector('#fullName') as HTMLElement, nameValidation.error || '');
      isValid = false;
    }

    const emailValidation = validateEmail(email);
    if (!emailValidation.valid) {
      showError(form.querySelector('#email') as HTMLElement, emailValidation.error || '');
      isValid = false;
    }

    const phoneValidation = validatePhone(phone);
    if (!phoneValidation.valid) {
      showError(form.querySelector('#phone') as HTMLElement, phoneValidation.error || '');
      isValid = false;
    }

    const messageValidation = validateMessage(message);
    if (!messageValidation.valid) {
      showError(form.querySelector('#message') as HTMLElement, messageValidation.error || '');
      isValid = false;
    }

    if (!isValid) {
      return;
    }

    // Disable button and show loading state
    submitButton.disabled = true;
    submitButton.textContent = 'Envoi en cours...';
    messageDiv.classList.add('hidden');

    const data = {
      fullName,
      company: company || '',
      phone: phone || '',
      email,
      message,
    };

    try {
      const response = await fetch('/api/contact', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data),
      });

      const result = await response.json();

      if (response.ok) {
        // Success
        messageDiv.textContent = 'Message envoyé avec succès ! Nous vous contacterons bientôt.';
        messageDiv.className = 'text-[15px] text-center py-2 rounded-[26px] bg-green-100 text-green-700 border border-green-300';
        messageDiv.classList.remove('hidden');
        form.reset();
      } else {
        // Error
        messageDiv.textContent = result.error || 'Erreur lors de l\'envoi du message.';
        messageDiv.className = 'text-[15px] text-center py-2 rounded-[26px] bg-red-100 text-red-700 border border-red-300';
        messageDiv.classList.remove('hidden');
      }
    } catch (error) {
      // Network error
      messageDiv.textContent = 'Erreur de connexion. Veuillez réessayer.';
      messageDiv.className = 'text-[15px] text-center py-2 rounded-[26px] bg-red-100 text-red-700 border border-red-300';
      messageDiv.classList.remove('hidden');
    } finally {
      // Re-enable button
      submitButton.disabled = false;
      submitButton.textContent = 'Envoyer';
    }
  });

  // Real-time validation on blur
  const inputs = form.querySelectorAll('input, textarea');
  inputs.forEach((input) => {
    input.addEventListener('blur', () => {
      const element = input as HTMLInputElement | HTMLTextAreaElement;
      const name = element.name;
      const value = element.value;

      if (name === 'fullName' && value) {
        const validation = validateName(value);
        if (!validation.valid) {
          showError(element, validation.error || '');
        } else {
          clearError(element);
        }
      } else if (name === 'email' && value) {
        const validation = validateEmail(value);
        if (!validation.valid) {
          showError(element, validation.error || '');
        } else {
          clearError(element);
        }
      } else if (name === 'phone' && value) {
        const validation = validatePhone(value);
        if (!validation.valid) {
          showError(element, validation.error || '');
        } else {
          clearError(element);
        }
      } else if (name === 'message' && value) {
        const validation = validateMessage(value);
        if (!validation.valid) {
          showError(element, validation.error || '');
        } else {
          clearError(element);
        }
      }
    });

    input.addEventListener('input', () => {
      clearError(input as HTMLElement);
    });
  });
</script>
