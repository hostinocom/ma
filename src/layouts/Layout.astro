---
import "../styles/global.css";
import Header from "../components/layout/Header.astro";
import Footer from "../components/layout/Footer.astro";
import { AstroFont } from "astro-font";
import Unfont from 'unplugin-fonts/astro/component.astro';

interface Props {
  title?: string;
  description?: string;
  canonical_url?: string;
  imageUrl?:string;
  ogAlt?: string;
  articleSchema? : any
}

const {
  title,
  description ,
  canonical_url ,
  imageUrl,
  ogAlt ,
  articleSchema
} = Astro.props;

// Get Crisp ID from environment variable
const crispId = import.meta.env.CRISP_WEBSITE_ID;
---
<!doctype html>
<html lang="fr-MA">
    <head>
        <Unfont />

        <link rel='dns-prefetch' href='//client.crisp.chat' />
        <link rel='dns-prefetch' href='//client.relay.crisp.chat' />
        <link rel='dns-prefetch' href='//www.googletagmanager.com' />
        <link rel='preconnect' href='https://client.crisp.chat' crossorigin />
        <link rel='preconnect' href='https://client.relay.crisp.chat' crossorigin />
    
	      	<link rel="icon" type="image/ico" href="/favicon.ico" />

		 <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  		<meta charset="UTF-8" />
        <title>{title}</title>
      <meta name="description" content={description} />
  <meta name="robots" content="follow, index, max-snippet:-1, max-video-preview:-1, max-image-preview:large" />
  <link rel="canonical" href={canonical_url} />

  <meta property="og:type" content="website" />
  <meta property="og:locale" content="fr_FR" />
  <meta property="og:url" content={canonical_url} />
  <meta property="og:site_name" content="Hostino" />
  <meta property="og:title" content={title} />
  <meta property="og:description" content={description} />
  <meta property="og:image" content={imageUrl} />
  <meta property="og:image:secure_url" content={imageUrl} />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta property="og:image:alt" content={ogAlt} />
  <meta property="og:image:type" content="image/png" />

  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content={title} />
  <meta name="twitter:description" content={description} />
  <meta name="twitter:image" content={imageUrl} />
  <meta name="twitter:creator" content="@admin" />

    {articleSchema && (
      <script type="application/ld+json" set:html={JSON.stringify(articleSchema)} />
    )}

   <script is:inline> (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5QLCSWWS');</script>

     {crispId && (
  <script is:inline define:vars={{ crispId }}>
    if (typeof window.$crisp === 'undefined') {
      window.$crisp = [];
      window.CRISP_WEBSITE_ID = crispId;
      
      // Force HTTP long-polling (bypasses WebSocket issues)
      window.CRISP_RUNTIME_CONFIG = {
        locale: 'fr',
        lock_maximized: false,
        lock_full_view: false,
        cross_origin_cookies: false
      };
      
      // Disable WebSocket transport entirely
      window.CRISP_TOKEN_ID = crispId;
      
      (function() {
        var d = document;
        var s = d.createElement("script");
        s.src = "https://client.crisp.chat/l.js";
        s.async = true;
        s.setAttribute('crossorigin', 'anonymous');
        
        // Inject script after Crisp loads to force polling
        s.onload = function() {
          if (window.$crisp) {
            // Force reconnection with polling only
            window.$crisp.push(['safe', true]);
          }
        };
        
        d.head.appendChild(s);
      })();
    }
  </script>
)}

	</head>

	<body >

<!-- Google Tag Manager (noscript) -->
    <noscript>
      <iframe 
        src="https://www.googletagmanager.com/ns.html?id=GTM-5QLCSWWS"
        height="0" 
        width="0" 
        style="display:none;visibility:hidden"
        title="Google Tag Manager">
      </iframe>
    </noscript>
    <!-- End Google Tag Manager (noscript) -->

	<Header />
		<slot />
    <Footer />



  Connection: Upgrade
	</body>
</html>